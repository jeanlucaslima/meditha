---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import VideoSection from '../components/VideoSection.astro';
import BenefitsGrid from '../components/BenefitsGrid.astro';
import PainDesireSection from '../components/PainDesireSection.astro';
import HowItWorks from '../components/HowItWorks.astro';
import RationaleSection from '../components/RationaleSection.astro';
import Deliverables from '../components/Deliverables.astro';
import OfferSection from '../components/OfferSection.astro';
import SocialProof from '../components/SocialProof.astro';
import AuthoritySection from '../components/AuthoritySection.astro';
import ComparisonSection from '../components/ComparisonSection.astro';
import ObjectionsSection from '../components/ObjectionsSection.astro';
import FAQSection from '../components/FAQSection.astro';
import Footer from '../components/Footer.astro';
import AnimatedLogo from '../components/AnimatedLogo.astro';
import StickyCTA from '../components/StickyCTA.tsx';
import CookieConsent from '../components/CookieConsent.tsx';
import { COPY } from '../lib/abFlags';
import { primaryBrandLogo } from '../lib/images';

// Default to variant A for server-side rendering
// Client-side variant will be determined dynamically
const variant = 'A' as const;
const ctaText = COPY.heroCTA[variant];

// SEO Data
const title = 'Dormir naturalmente em 7 dias | Método Lux';
const description = 'Checklist digital baseado em cronobiologia para dormir em até 7 noites sem melatonina, com suporte humano e garantia de 7 dias.';

// Schema.org structured data
const logoUrl = Astro.site ? new URL(primaryBrandLogo.src, Astro.site).href : primaryBrandLogo.src;
const schema = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'WebPage',
      '@id': 'https://metodolux.com.br/durma',
      url: 'https://metodolux.com.br/durma',
      name: title,
      description: description,
      inLanguage: 'pt-BR',
      isPartOf: {
        '@type': 'WebSite',
        '@id': 'https://metodolux.com.br',
        name: 'Método Lux',
        description: 'Dormir Natural',
        inLanguage: 'pt-BR'
      }
    },
    {
      '@type': 'BreadcrumbList',
      itemListElement: [
        {
          '@type': 'ListItem',
          position: 1,
          name: 'Home',
          item: 'https://metodolux.com.br'
        },
        {
          '@type': 'ListItem',
          position: 2,
          name: 'Checklist Método Lux',
          item: 'https://metodolux.com.br/durma'
        }
      ]
    },
    {
      '@type': 'Organization',
      '@id': 'https://metodolux.com.br',
      name: 'Método Lux',
      description: 'Método natural para melhorar a qualidade do sono',
      url: 'https://metodolux.com.br',
      logo: {
        '@type': 'ImageObject',
        url: logoUrl
      },
      contactPoint: {
        '@type': 'ContactPoint',
        contactType: 'customer service',
        email: 'contato@metodolux.com.br'
      }
    },
    {
      '@type': 'Service',
      name: 'Checklist Durma Natural – Método Lux',
      description: 'Checklist digital para dormir naturalmente em até 7 noites, com suporte humano e garantia de 7 dias.',
      provider: {
        '@type': 'Organization',
        name: 'Método Lux'
      },
      serviceType: 'Digital Product',
      areaServed: 'BR',
      offers: [
        {
          '@type': 'Offer',
          price: '67.00',
          priceCurrency: 'BRL',
          availability: 'https://schema.org/InStock',
          url: 'https://metodolux.com.br/durma',
          itemCondition: 'https://schema.org/NewCondition'
        }
      ]
    }
  ]
};
---

<BaseLayout
  title={title}
  description={description}
  schema={schema}
>
  <!-- Hero Section -->
  <Hero variant={variant} />

  <!-- Video Section -->
  <VideoSection />

  <!-- Benefits Section -->
  <BenefitsGrid />

  <!-- Pain and Desires -->
  <PainDesireSection />

  <!-- How It Works Section -->
  <HowItWorks />

  <!-- Scientific Rationale -->
  <RationaleSection />

  <!-- Deliverables Section -->
  <Deliverables />

  <!-- Offer Section -->
  <OfferSection />

  <!-- Social Proof Section -->
  <SocialProof />

  <!-- Authority Section -->
  <AuthoritySection />

  <!-- Comparison Section -->
  <ComparisonSection />

  <!-- Objections Section -->
  <ObjectionsSection />

  <!-- FAQ Section -->
  <FAQSection />

  <!-- Animated Logo -->
  <AnimatedLogo />

  <!-- Footer -->
  <Footer />

  <!-- Interactive Islands -->
  <StickyCTA client:load ctaText={ctaText} variant={variant} />
  <CookieConsent client:load />
</BaseLayout>

<script>
  import { trackPageView } from '../lib/analytics';

  // Track page view on load
  document.addEventListener('DOMContentLoaded', () => {
    trackPageView();
  });
</script>

<style>
  /* Critical CSS for above-the-fold content */
  body {
    margin: 0;
    width: 100%;
    min-height: 100vh;
  }

  /* Ensure smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Optimize font rendering */
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
</style>
