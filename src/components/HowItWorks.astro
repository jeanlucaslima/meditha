---
import Container from './ui/Container.astro';
import Section from './ui/Section.astro';
import Grid from './ui/Grid.astro';
import Card from './ui/Card.astro';
import Icon from './ui/Icon.astro';
import Button from './ui/Button.astro';

const steps = [
  {
    step: '1',
    icon: 'document-text',
    title: 'Manhã Lux',
    description: 'Ao despertar, você segue microações como olhar para o céu, hidratar o corpo e expor-se à luz natural por alguns minutos.',
    highlight: 'Reset circadiano',
    hasButton: false
  },
  {
    step: '2',
    icon: 'document-text',
    title: 'Tarde leve',
    description: 'Orientações para distribuir refeições, reduzir cafeína e manter energia sem cair no cansaço mental.',
    highlight: 'Rotina guiada',
    hasButton: false
  },
  {
    step: '3',
    icon: 'chart-bar',
    title: 'Noite sem estímulos',
    description: 'Checklist para desacelerar o cérebro, controlar luz azul e preparar o corpo para dormir rápido.',
    highlight: 'Luz controlada',
    hasButton: false
  },
  {
    step: '4',
    icon: 'moon',
    title: 'Quarto caverna',
    description: 'Passo a passo para montar o ambiente ideal: temperatura, luz, silêncio e rituais calmantes que sinalizam hora de dormir.',
    highlight: 'Sono profundo',
    hasButton: false
  }
];
---

<Section bg="base" id="how-it-works">
  <Container>
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl font-bold text-base-content mb-4">
        Como o Checklist Durma Natural funciona na prática
      </h2>
      <p class="text-lg text-base-content/70 max-w-2xl mx-auto">
        A metodologia combina ritmo circadiano, luz natural e ajustes simples de rotina para entregar resultados consistentes em poucos dias.
      </p>
    </div>

    <Grid cols={4} gap="xl">
      {steps.map((step, index) => (
        <div class="relative">
          {/* Step connector line */}
          {index < steps.length - 1 && (
            <div class="hidden lg:block absolute top-12 left-full w-full h-0.5 bg-gradient-to-r from-primary-300 to-transparent z-0 transform translate-x-4"></div>
          )}

          <Card class="relative z-10 text-center h-full">
            <div class="flex flex-col items-center space-y-6">
              <div class="relative">
                <div class="w-20 h-20 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold mb-2">
                  {step.step}
                </div>
                <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-accent rounded-full flex items-center justify-center">
                  <Icon name={step.icon} size="sm" class="text-white" />
                </div>
              </div>

              <h3 class="text-xl font-semibold text-base-content">
                {step.title}
              </h3>

              <p class="text-base-content/70 leading-relaxed">
                {step.description}
              </p>

              <div class="inline-flex items-center px-3 py-1 bg-accent-100 text-accent-800 rounded-full text-sm font-medium">
                {step.highlight}
              </div>
            </div>
          </Card>
        </div>
      ))}
    </Grid>

    <!-- CTA Section -->
    <div class="text-center mt-16">
      <p class="text-lg text-base-content/80 mb-6">
        Pronta para seguir um passo a passo validado e simplificar suas noites?
      </p>
      <a
        href="#oferta"
        class="btn btn-primary btn-lg"
        data-event="durma_cta_click"
        data-position="how-it-works"
      >
        Quero o checklist completo
      </a>
    </div>
  </Container>
</Section>

<script>
  import { trackSectionView, trackCTAClick } from '../lib/analytics';

  // Track section view
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        trackSectionView('howitworks');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.3 });

  const section = document.getElementById('how-it-works');
  if (section) {
    observer.observe(section);
  }

  // Track CTA clicks
  const ctaButtons = section?.querySelectorAll('[data-event="durma_cta_click"]');
  ctaButtons?.forEach((button) => {
    button.addEventListener('click', (e) => {
      const position = button.getAttribute('data-position');
      trackCTAClick(position || 'how-it-works');
    });
  });
</script>
